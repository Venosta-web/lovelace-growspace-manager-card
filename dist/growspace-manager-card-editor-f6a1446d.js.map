{"version":3,"file":"growspace-manager-card-editor-f6a1446d.js","sources":["../src/growspace-manager-card-editor.ts"],"sourcesContent":["import { LitElement, html, css } from \"lit\";\r\nimport { customElement, property, state } from \"lit/decorators.js\";\r\nimport type { LovelaceCardEditor } from \"custom-card-helpers\";\r\nimport type { GrowspaceManagerCardConfig } from \"./types\";\r\n\r\n@customElement(\"growspace-manager-card-editor\")\r\nexport class GrowspaceManagerCardEditor extends LitElement implements LovelaceCardEditor {\r\n  @property({ attribute: false }) public hass?: any;\r\n  @property({ attribute: false }) private _config?: GrowspaceManagerCardConfig;\r\n  @state() private _growspaceOptions: string[] = [];\r\n\r\n  private _unsubStateChanged?: () => void;\r\n\r\n  public setConfig(config: GrowspaceManagerCardConfig): void {\r\n    this._config = config;\r\n    this._loadGrowspaces();\r\n  }\r\n\r\n  updated(changedProps: Map<string, any>) {\r\n    if (changedProps.has(\"hass\") && this.hass) {\r\n      this._loadGrowspaces();\r\n      this._subscribeToSensorUpdates();\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    if (this._unsubStateChanged) {\r\n      this._unsubStateChanged();\r\n      this._unsubStateChanged = undefined;\r\n    }\r\n  }\r\n\r\n  private _subscribeToSensorUpdates() {\r\n  if (!this.hass || this._unsubStateChanged) return;\r\n\r\n  this._unsubStateChanged = this.hass.connection.subscribeEvents(\r\n    (event: any) => {\r\n      const newState = event.data.new_state;\r\n      if (newState?.entity_id === \"sensor.growspaces_list\") {\r\n        if (Array.isArray(newState.attributes?.growspaces)) {\r\n          this._growspaceOptions = newState.attributes.growspaces;\r\n        } else {\r\n          this._growspaceOptions = [];\r\n        }\r\n      }\r\n    },\r\n    \"state_changed\"\r\n  );\r\n}\r\n\r\n  private _loadGrowspaces() {\r\n    if (!this.hass) return;\r\n\r\n    const entity = this.hass.states[\"sensor.growspaces_list\"];\r\n    if (entity && entity.attributes?.growspaces) {\r\n      const gsObj = entity.attributes.growspaces;\r\n      // Option 1: just values (friendly names)\r\n      this._growspaceOptions = Object.values(gsObj);\r\n\r\n      // Option 2: key/value pairs if you want IDs as the value\r\n      // this._growspaceOptions = Object.entries(gsObj).map(([id, name]) => ({ id, name }));\r\n    } else {\r\n      this._growspaceOptions = [];\r\n    }\r\n  }\r\n\r\n  static styles = css`\r\n    .form-group {\r\n      margin-bottom: 12px;\r\n    }\r\n    label {\r\n      display: block;\r\n      font-weight: bold;\r\n      margin-bottom: 4px;\r\n    }\r\n    select {\r\n      width: 100%;\r\n      padding: 4px;\r\n      box-sizing: border-box;\r\n    }\r\n  `;\r\n\r\n  render() {\r\n    if (!this._config) return html``;\r\n\r\n    return html`\r\n      <div class=\"form-group\">\r\n        <label>Default Growspace</label>\r\n        <select\r\n          .value=${this._config.default_growspace ?? \"\"}\r\n          @change=${(e: Event) =>\r\n            this._valueChanged(\r\n              \"default_growspace\",\r\n              (e.target as HTMLSelectElement).value\r\n            )}\r\n        >\r\n          <option value=\"\">Select a growspace</option>\r\n          ${this._growspaceOptions.length === 0\r\n            ? html`<option disabled>No growspaces found</option>`\r\n            : this._growspaceOptions.map(\r\n                (gs) => html`<option value=\"${gs}\">${gs}</option>`\r\n              )}\r\n        </select>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private _valueChanged(key: string, value: any) {\r\n    if (!this._config) return;\r\n    const newConfig = { ...this._config, [key]: value };\r\n    this.dispatchEvent(\r\n      new CustomEvent(\"config-changed\", {\r\n        detail: { config: newConfig },\r\n        bubbles: true,\r\n        composed: true,\r\n      })\r\n    );\r\n  }\r\n}\r\n"],"names":["GrowspaceManagerCardEditor","LitElement","constructor","this","_growspaceOptions","setConfig","config","_config","_loadGrowspaces","updated","changedProps","has","hass","_subscribeToSensorUpdates","disconnectedCallback","super","_unsubStateChanged","undefined","connection","subscribeEvents","event","newState","data","new_state","entity_id","Array","isArray","attributes","growspaces","entity","states","gsObj","Object","values","render","html","default_growspace","e","_valueChanged","target","value","length","map","gs","key","newConfig","dispatchEvent","CustomEvent","detail","bubbles","composed","styles","css","__decorate","property","attribute","prototype","state","customElement"],"mappings":"0GAMO,IAAMA,EAAN,cAAyCC,EAAzC,WAAAC,uBAGYC,KAAiBC,kBAAa,EA8GhD,CA1GQ,SAAAC,CAAUC,GACfH,KAAKI,QAAUD,EACfH,KAAKK,iBACN,CAED,OAAAC,CAAQC,GACFA,EAAaC,IAAI,SAAWR,KAAKS,OACnCT,KAAKK,kBACLL,KAAKU,4BAER,CAED,oBAAAC,GACEC,MAAMD,uBACFX,KAAKa,qBACPb,KAAKa,qBACLb,KAAKa,wBAAqBC,EAE7B,CAEO,yBAAAJ,GACHV,KAAKS,OAAQT,KAAKa,qBAEvBb,KAAKa,mBAAqBb,KAAKS,KAAKM,WAAWC,gBAC5CC,IACC,MAAMC,EAAWD,EAAME,KAAKC,UACA,2BAAxBF,GAAUG,YACRC,MAAMC,QAAQL,EAASM,YAAYC,YACrCzB,KAAKC,kBAAoBiB,EAASM,WAAWC,WAE7CzB,KAAKC,kBAAoB,KAI/B,iBAEH,CAES,eAAAI,GACN,IAAKL,KAAKS,KAAM,OAEhB,MAAMiB,EAAS1B,KAAKS,KAAKkB,OAAO,0BAChC,GAAID,GAAUA,EAAOF,YAAYC,WAAY,CAC3C,MAAMG,EAAQF,EAAOF,WAAWC,WAEhCzB,KAAKC,kBAAoB4B,OAAOC,OAAOF,EAIxC,MACC5B,KAAKC,kBAAoB,EAE5B,CAkBD,MAAA8B,GACE,OAAK/B,KAAKI,QAEH4B,CAAI;;;;mBAIIhC,KAAKI,QAAQ6B,mBAAqB;oBAChCC,GACTlC,KAAKmC,cACH,oBACCD,EAAEE,OAA6BC;;;YAIA,IAAlCrC,KAAKC,kBAAkBqC,OACrBN,CAAI,gDACJhC,KAAKC,kBAAkBsC,IACpBC,GAAOR,CAAI,kBAAkBQ,MAAOA;;;MAjBvBR,CAAI,EAsB/B,CAEO,aAAAG,CAAcM,EAAaJ,GACjC,IAAKrC,KAAKI,QAAS,OACnB,MAAMsC,EAAY,IAAK1C,KAAKI,QAASqC,CAACA,GAAMJ,GAC5CrC,KAAK2C,cACH,IAAIC,YAAY,iBAAkB,CAChCC,OAAQ,CAAE1C,OAAQuC,GAClBI,SAAS,EACTC,UAAU,IAGf,GAnDMlD,EAAMmD,OAAGC,CAAG;;;;;;;;;;;;;;IA5DoBC,EAAA,CAAtCC,EAAS,CAAEC,WAAW,6BAA2BvD,EAAAwD,UAAA,YAAA,GACVH,EAAA,CAAvCC,EAAS,CAAEC,WAAW,6BAAsDvD,EAAAwD,UAAA,eAAA,GAC5DH,EAAA,CAAhBI,4BAAiDzD,EAAAwD,UAAA,yBAAA,GAHvCxD,EAA0BqD,EAAA,CADtCK,EAAc,kCACF1D"}